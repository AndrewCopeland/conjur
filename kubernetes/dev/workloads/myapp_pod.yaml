---
apiVersion: v1
kind: Pod
metadata:
  name: myapp-pod
spec:
  containers:
  - image: authenticator
    imagePullPolicy: IfNotPresent
    name: authenticator
    env:
    - name: CONJUR_APPLIANCE_URL
      value: http://conjur
    - name: CONJUR_AUTHN_URL
      value: http://conjur/authn-kubernetes/dev/
    - name: CONJUR_ACCOUNT
      value: cucumber
    - name: CONJUR_AUTHN_LOGIN
      value: host/conjur/authn-kubernetes/dev/workloads/myapp
    - name: K8S_NAMESPACE
      valueFrom:
        fieldRef:
          fieldPath: metadata.namespace
    volumeMounts:
    - mountPath: /run/conjur
      name: conjur-access-token

  - image: myapp
    imagePullPolicy: IfNotPresent
    name: myapp
    env:
    - name: CONJUR_APPLIANCE_URL
      value: http://conjur
    - name: CONJUR_ACCOUNT
      value: cucumber
    volumeMounts:
    - mountPath: /run/conjur/
      name: conjur-access-token

  volumes:
    - name: conjur-access-token
      emptyDir:
        medium: Memory
